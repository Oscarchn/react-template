## 目标

* 在项目管理多维表中，用户点击/选中某条项目记录时，自动找到其单向关联的任务，并以清晰的 UI 展示任务的执行人与状态。

## 现有基础

* 已集成 `@lark-base-open/js-sdk`，可访问 Base 表与记录（见 `src/App.tsx:18-24` 获取选择、`src/App.tsx:10-17` 增加记录示例）。

* 前端框架与 UI：React + TypeScript + Vite + Semi UI，足以实现交互与展示。

* 环境检测组件：`src/components/LoadApp/index.tsx` 用于提示插件需在 Base WebView 内运行。

* 国际化基础：`src/locales/` 已有 i18n 配置，可复用中英文文案。

## 数据模型假设

* 表 `Project`：项目记录，主键为记录 `recordId`。

* 表 `Task`：任务记录，包含一个单向关联字段指向 `Project`（一对多）。

* 任务字段：

  * `Assignee`（人员字段，User）

  * `Status`（单选字段，SingleSelect）

  * `Name`（任务名称，文本字段）

## 技术方案

* 监听当前选中记录：

  * 首次通过 `bitable.base.getSelection()` 获取 `tableId` 与 `recordId`。

  * 订阅选中变化事件（例如 `bitable.base.onSelectionChange`）以实时刷新关联任务。

* 获取关联任务：

  * 获取 `Task` 表实例：通过表名或 `tableId`。

  * 优先方案：使用关联字段 API 从 `Task` 表筛选出其关联值指向当前 `Project` `recordId` 的记录。

  * 兜底方案：分页遍历 `Task` 记录，读取关联字段值，过滤出包含该项目 `recordId` 的任务。

* 提取展示数据：对每条任务读取 `Name`、`Assignee`（用户列表或单用户）、`Status`（选项名称与颜色）。

* UI 展示：

  * 顶部展示当前项目名称与刷新控制。

  * 列表/卡片：每项显示任务名称、执行人头像/姓名、状态标签（按 Semi UI Tag/Badge）。

  * 可选：按 `Status` 分组、状态筛选、搜索框。

* 性能与容错：

  * 大表分页加载、loading skeleton、空态占位。

  * 无权限或字段缺失时给出明确提示。

* 国际化：复用 `i18next`，文案中英双语。

## 交互流程

1. 用户在 `Project` 表中选中一行。
2. 插件读取选中记录 `recordId` 与所属表是否为项目表。
3. 根据项目记录查找 `Task` 表中关联到该项目的任务集合。
4. 渲染任务列表：展示执行人与状态；支持筛选与刷新。

## 目录与代码改动点（不执行，仅规划）

* `src/App.tsx`：增加选择监听、状态管理与渲染容器。

* `src/services/taskQuery.ts`：封装任务查询与关联过滤逻辑（新文件）。

* `src/components/TaskList/`：任务列表组件、任务卡片组件（新目录）。

* `src/locales/`：增量文案（Assignee、Status、No tasks 等）。

## 验证与测试

* 在 Base 环境中通过 WebView 运行，选中不同项目记录验证任务列表是否正确。

* 构造包含大量任务的项目验证分页与性能。

* 本地开发可添加 mock 模式以调试 UI，但真实数据需在 Base 中验证。

## 我们已具备的本地编写能力

* 前端与 UI 能力、SDK 依赖已具备，可以开始本地编码与 UI 搭建。

* 需要在 Base 中注册 WebView 地址以进行真实数据联调（`README.md` 已提供指引）。

## 需要您补充的信息

* 表标识：

  * 项目表：名称或 `tableId`

  * 任务表：名称或 `tableId`

* **字段标识（名称或** **`fieldId`）：**

  * **任务表中的项目关联字段（单向关联）**

  * **任务执行人字段（User 类型）**

  * **任务状态字段（SingleSelect 类型）**

  * **任务名称字段（文本类型）**

* 业务期望：

  * UI 展示偏好（列表、卡片、按状态分组？）

  * 任务数量级与性能预期（例如单项目下最多 N 条任务）

  * 是否需要筛选/搜索、分页大小偏好

* 运行环境：确认插件将运行在 Base 中，并提供/确认 WebView 注册方式（或由我按现有指引配置）。

## 下一步

* 您确认以上信息或提供缺失字段与表标识后，我将开始实现查询与 UI 组件，并在 Base 环境联调，交付可用插件。

